/*! noweibo - v0.0.1 - 2013-10-06
* http://noweibo.com
* Copyright (c) 2013 Codeb Fan; */
angular.module("noweibo.service",[]),angular.module("noweibo.directive",[]).directive("comShortUrl",function($timeout){return function(a,b){var c=function(){var a=new RegExp("(http://t.cn/[a-zA-Z0-9]{4,9})","g"),c='<a href="$1" target="_blank">$1</a>';b.html(b.text().replace(a,c))};$timeout(c,0)}}),angular.module("noweibo.filter",[]).filter("colorFilter",function(){return function(a){var b=null;return b=50>a?"text-success":100>a?"text-primary":300>a?"text-warning":"text-danger",'<span class="'+b+'">'+a+"</span>"}}),window.APP=angular.module("noweiboHome",["noweibo.service","noweibo.directive","noweibo.filter"]),APP.controller("AppCtrl",["$scope","$http","$timeout",function($scope,$http,$timeout){$scope.user=null,$scope.pageIndex=0,$scope.pageSize=9,$scope.pages=[0,1,2,3,4,5,6],$scope.validMethods=["time","repost","comment"],$scope.orderMethod="time",$scope.weibos=[],$scope.pageFilter=function(a){var b=$scope.pageIndex*$scope.pageSize,c=b+$scope.pageSize;return a>=b&&c>a},$scope.pageBtnClass=function(a){return a===$scope.pageIndex?"active":""},$scope.changePage=function(a){$scope.pageIndex=a},$scope.orderBtnClass=function(a){return a===$scope.orderMethod?"active":""},$scope.changeOrder=function(a){-1!==$scope.validMethods.indexOf(a)&&($scope.orderMethod=a,$scope.pageIndex=0)},$scope.orderFilter=function(){var a={time:"create_date",repost:"reposts_count",comment:"comments_count"};return a[$scope.orderMethod]},$scope.optionDeleteBtnClass=function(){return $scope.user&&$scope.user.options["delete"]?"active":""},$scope.updateUserOptions=function(a){"delete"===a&&$http({method:"POST",url:"/user/option"}).success(function(a){"OK"===a.status&&($scope.user.options=a.data)}).error(function(a,b){console.log(b)})},$scope.queryWeibo=function(){$http({method:"GET",url:"/weibo/query"}).success(function(a){"OK"===a.status&&($scope.weibos=a.data)}).error(function(a,b){console.log(b)})},$scope.syncWeibo=function(){$http({method:"POST",url:"/weibo/sync"}).success(function(){$scope.queryWeibo()}).error(function(a,b){console.log(b)})},$scope.syncUser=function(){$http({method:"GET",url:"/user/info"}).success(function(a){"OK"===a.status&&($scope.user=a.data,$scope.queryWeibo())}).error(function(a,b){console.log(b)})},$timeout(function(){$scope.syncUser(),$scope.syncWeibo()},0)}]);